!function(e){var n={};function t(s){if(n[s])return n[s].exports;var i=n[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:s})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(s,i,function(n){return e[n]}.bind(null,i));return s},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";t.r(n);const s={ACTIVATE:"activate",STOP:"stop",RELOAD_CONFIG:"reload_config"},i={NOTIFICATION:"notification",ACTION:"action"};var o=class{constructor(e){this._agent=e}listenForIncomingMessages(){chrome.runtime.onMessage.addListener((e,n,t)=>{n.tab||this.handleIncomingMessage(e).then(()=>t({message:"received"})).catch(e=>console.log(e))})}async handleIncomingMessage(e){if(!(e.type in Object.values(i)))throw new Error(`Invalid message type: ${e.type} not in [${Object.values(i).join(", ")}]`);if(!(e.message in Object.values(s)))throw new Error(`Invalid command: ${e.message}`);switch(e.type){case i.NOTIFICATION:this.handleIncomingNotification(e);break;case i.ACTION:await this.handleIncomingAction(e);break;default:throw new Error("Unhandled message types.")}}handleIncomingNotification(e){console.log(e.message)}async handleIncomingAction(e){switch(e.message){case s.ACTIVATE:await this._agent.runResponseProcess();break;case s.STOP:this._agent.stopResponseProcess();break;case s.RELOAD_CONFIG:await this._agent.reloadProcessConfig();break;default:throw new Error("Unhandled command type")}}};var r=class{constructor(){this._elNotificationNotifier=null,this._arrBirthdayWishesToBeProcessed=[]}registerNotificationEvents(){console.log("Notification events registered")}stopNotificationEvents(){console.log("Notification events stoped")}};(new class{constructor(){this._incomingMessageHandler=null,this._bdayNotificationHandler=null,this._bRunning=!1,this.objResponsesConfig=null}init(){this._setup()}async runResponseProcess(){this._bRunning?console.log("Agent is allready running"):(this._bRunning=!0,null===this._bdayNotificationHandler&&(this._bdayNotificationHandler=new r),this.objResponsesConfig=await this._retrieveProcessConfig(),this._bdayNotificationHandler.setReponsesConfig(this.objResponsesConfig),this._bdayNotificationHandler.registerNotificationEvents())}stopResponseProcess(){!1===this._bRunning&&console.log("Agent must be running to be stoped."),this._bRunning=!1,this._bdayNotificationHandler.stopNotificationEvents()}async reloadProcessConfig(){if(this._bRunning)return this.stopResponseProcess(),void await this.runResponseProcess();this.objResponsesConfig=await this._retrieveProcessConfig()}_retrieveProcessConfig(){return new Promise((e,n)=>{chrome.storage.sync.get(["birthday","responses","exceptions","stoped"],t=>{try{e(t)}catch(e){n(e)}})})}_setup(){this._incomingMessageHandler=new o(this),this._incomingMessageHandler.listenForIncomingMessages()}}).init()}]);