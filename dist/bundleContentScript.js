!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const s={ACTIVATE:"activate",STOP:"stop",RELOAD_CONFIG:"reload_config"},i={NOTIFICATION:"notification",ACTION:"action"};var o=class{constructor(e){this._agent=e}listenForIncomingMessages(){chrome.runtime.onMessage.addListener((e,t,n)=>{t.tab||(n({message:"received"}),this.handleIncomingMessage(e).catch(e=>console.log(e)))})}async handleIncomingMessage(e){if(!Object.values(i).includes(e.type))throw new Error(`Invalid message type: ${e.type} not in [${Object.values(i).join(", ")}]`);if(!Object.values(s).includes(e.message))throw new Error(`Invalid command: ${e.message}`);switch(e.type){case i.NOTIFICATION:this.handleIncomingNotification(e);break;case i.ACTION:await this.handleIncomingAction(e);break;default:throw new Error("Unhandled message types.")}}handleIncomingNotification(e){console.log(e.message)}async handleIncomingAction(e){switch(e.message){case s.ACTIVATE:await this._agent.runResponseProcess();break;case s.STOP:this._agent.stopResponseProcess();break;case s.RELOAD_CONFIG:await this._agent.reloadProcessConfig();break;default:throw new Error("Unhandled command type")}}};var r=class{constructor(e=null){this.objResponsesConfig=e,this._elNotificationNotifier=null,this._arrBirthdayWishesToBeProcessed=[],this._observer=null,this._elNotificationButton=document.getElementsByClassName("_2n_9")[2],this._nLastCalled=null}registerNotificationEvents(){console.log("Notification events registered"),null===this._observer&&this._createObserver(),this._observer.observe(this._elNotificationButton,{attributes:!0,childList:!0,subtree:!0})}stopNotificationEvents(){null!==this._observer&&(console.log("Notification events stoped"),this._observer.disconnect())}_createObserver(){this._observer=new MutationObserver(e=>{if(this.stopNotificationEvents(),null!==this._nLastCalled&&Date.now()-this._nLastCalled<1e3)return;console.log(e),this._elNotificationButton.click();const t=document.getElementById("fbNotificationsFlyout").getElementsByClassName("_32hm")[0].getElementsByTagName("li");console.log("Lists"),console.log(t),this.registerNotificationEvents(),this._nLastCalled=Date.now()})}};(new class{constructor(){this._incomingMessageHandler=null,this._bdayNotificationHandler=null,this._bRunning=!1,this.objResponsesConfig=null}init(){this._setup()}async runResponseProcess(){this._bRunning?console.log("Agent is allready running"):(this._bRunning=!0,null===this._bdayNotificationHandler&&(this._bdayNotificationHandler=new r),this.objResponsesConfig=await this._retrieveProcessConfig(),this._bdayNotificationHandler.objResponsesConfig=this.objResponsesConfig,this._bdayNotificationHandler.registerNotificationEvents())}stopResponseProcess(){!1===this._bRunning&&console.log("Agent must be running to be stoped."),this._bRunning=!1,this._bdayNotificationHandler.stopNotificationEvents()}async reloadProcessConfig(){if(this._bRunning)return this.stopResponseProcess(),void await this.runResponseProcess();this.objResponsesConfig=await this._retrieveProcessConfig()}_retrieveProcessConfig(){return new Promise((e,t)=>{try{chrome.storage.sync.get(["birthday","responses","exceptions","stopped"],t=>{e(t)})}catch(e){t(e)}})}_setup(){this._incomingMessageHandler=new o(this),this._incomingMessageHandler.listenForIncomingMessages()}}).init()}]);